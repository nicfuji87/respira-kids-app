# ğŸ¯ Guia de Uso: Agrupamento de Consultas por Paciente

## ğŸ“ LocalizaÃ§Ã£o

**Financeiro â†’ Consultas**

---

## ğŸ”„ Como Alternar entre VisualizaÃ§Ãµes

### BotÃ£o de Toggle (Canto Superior Direito)

O botÃ£o muda entre dois modos:

| Modo         | Ãcone    | DescriÃ§Ã£o                          |
| ------------ | -------- | ---------------------------------- |
| **Agrupado** | ğŸ‘¥ Users | Agrupa consultas por paciente      |
| **Lista**    | ğŸ“‹ List  | Mostra todas as consultas em lista |

---

## ğŸ‘¥ Modo AGRUPADO (Recomendado)

### VisualizaÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘¤ JoÃ£o Silva              3 consultas  2 nÃ£o pagas  â”‚
â”‚  ğŸ’° Total: R$ 450,00                                 â”‚
â”‚  ğŸ¢ Empresa: Respira Kids                           â”‚
â”‚                                          [ âŒ„ ]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘¤ Maria Santos            5 consultas  5 nÃ£o pagas  â”‚
â”‚  ğŸ’° Total: R$ 750,00                                 â”‚
â”‚  ğŸ¢ Empresa: Respira Kids                           â”‚
â”‚                                          [ âŒ„ ]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Funcionalidades

#### 1ï¸âƒ£ Expandir/Colapsar Paciente

- **Clique no card do paciente** para ver/ocultar as consultas
- O Ã­cone muda:
  - `[ âŒ„ ]` = Expandir
  - `[ âŒƒ ]` = Colapsar

#### 2ï¸âƒ£ Ver Detalhes de Cada Consulta (Quando Expandido)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘¤ JoÃ£o Silva              3 consultas  2 nÃ£o pagas  â”‚
â”‚  ğŸ’° Total: R$ 450,00                                 â”‚
â”‚  ğŸ¢ Empresa: Respira Kids                           â”‚
â”‚                                          [ âŒƒ ]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“… 15/01/2025  14:00-15:00  Fisioterapia           â”‚
â”‚  ğŸ‘¨â€âš•ï¸ Dr. Carlos    ğŸ“ ClÃ­nica Central                â”‚
â”‚  ğŸ’° R$ 150,00  ğŸŸ¡ Pendente                    [ > ] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“… 18/01/2025  14:00-15:00  Fisioterapia           â”‚
â”‚  ğŸ‘¨â€âš•ï¸ Dr. Carlos    ğŸ“ ClÃ­nica Central                â”‚
â”‚  ğŸ’° R$ 150,00  ğŸŸ¡ Pendente                    [ > ] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“… 22/01/2025  14:00-15:00  Fisioterapia           â”‚
â”‚  ğŸ‘¨â€âš•ï¸ Dr. Carlos    ğŸ“ ClÃ­nica Central                â”‚
â”‚  ğŸ’° R$ 150,00  âœ… Pago                        [ > ] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… Modo de SeleÃ§Ã£o para CobranÃ§a em Massa

### 1ï¸âƒ£ Ativar Modo de SeleÃ§Ã£o

Clique no botÃ£o **"Selecionar"** (canto superior direito)

### 2ï¸âƒ£ TrÃªs Formas de Selecionar

#### OpÃ§Ã£o A: Selecionar Paciente Inteiro

- **Checkbox ao lado do nome do paciente**
- âœ… Seleciona TODAS as consultas nÃ£o pagas do paciente automaticamente
- âš ï¸ Consultas pagas ou canceladas nÃ£o sÃ£o selecionadas

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [âœ“] ğŸ‘¤ JoÃ£o Silva          2 consultas nÃ£o pagas   â”‚
â”‚       ğŸ’° Total nÃ£o pago: R$ 300,00                  â”‚
â”‚                                          [ âŒ„ ]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### OpÃ§Ã£o B: Selecionar Consultas Individuais

1. Expanda o card do paciente
2. Marque o checkbox de cada consulta desejada

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ ] ğŸ‘¤ JoÃ£o Silva          3 consultas  2 nÃ£o pagas  â”‚
â”‚                                          [ âŒƒ ]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [âœ“] ğŸ“… 15/01  14:00  Fisioterapia  R$ 150,00 ğŸŸ¡  â”‚
â”‚  [âœ“] ğŸ“… 18/01  14:00  Fisioterapia  R$ 150,00 ğŸŸ¡  â”‚
â”‚  [ ] ğŸ“… 22/01  14:00  Fisioterapia  R$ 150,00 âœ…  â”‚ â† Pago (nÃ£o pode)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### OpÃ§Ã£o C: Selecionar Todos NÃ£o Pagos

- Use o botÃ£o **"Selecionar TODAS nÃ£o pagas"**
- Seleciona TODAS as consultas nÃ£o pagas de TODOS os pacientes
- âš ï¸ Use com cuidado em perÃ­odos longos!

### 3ï¸âƒ£ Gerar CobranÃ§a

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ X Cancelar ]  [ ğŸ’³ Gerar CobranÃ§as (5) ]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         âš ï¸ IMPORTANTE âš ï¸
As consultas sÃ£o agrupadas POR PACIENTE
Cada paciente terÃ¡ UMA cobranÃ§a gerada
```

### 4ï¸âƒ£ Resultado

```
âœ… CobranÃ§as processadas

3 paciente(s) com sucesso:
â€¢ JoÃ£o Silva: R$ 300,00
â€¢ Maria Santos: R$ 750,00
â€¢ Pedro Costa: R$ 200,00

âŒ 1 com falha:
â€¢ Ana Oliveira: 2 consulta(s) nÃ£o tÃªm empresa de
  faturamento configurada
```

---

## ğŸ” Filtros DisponÃ­veis (Ambos os Modos)

### Filtros de Pesquisa

| Filtro                  | DescriÃ§Ã£o                                          | Exemplo        |
| ----------------------- | -------------------------------------------------- | -------------- |
| ğŸ” **Busca**            | Nome do paciente ou responsÃ¡veis                   | "JoÃ£o Silva"   |
| ğŸ“… **PerÃ­odo**          | MÃªs atual, anterior, Ãºltimos X dias, personalizado | "MÃªs atual"    |
| ğŸ‘¨â€âš•ï¸ **Profissional**     | Filtrar por profissional especÃ­fico                | "Dr. Carlos"   |
| ğŸ’¼ **Tipo de ServiÃ§o**  | Filtrar por tipo de consulta                       | "Fisioterapia" |
| ğŸ’° **Status Pagamento** | Pago, Pendente, Em aberto, Cancelado               | "Pendente"     |
| ğŸ”„ **OrdenaÃ§Ã£o**        | Data, Paciente, Valor                              | "Paciente A-Z" |

### BotÃ£o "Limpar"

- Remove todos os filtros aplicados
- Volta para visualizaÃ§Ã£o padrÃ£o (MÃªs atual)

---

## âš ï¸ Regras e RestriÃ§Ãµes

### âŒ Consultas que NÃƒO podem ser selecionadas:

1. **Consultas Pagas** âœ… (jÃ¡ foram cobradas)
2. **Consultas Canceladas** â›”
3. **Consultas com Fatura** ğŸ§¾ (jÃ¡ tÃªm cobranÃ§a gerada)
4. **Consultas sem Empresa de Faturamento** ğŸ¢âŒ

### âš ï¸ ValidaÃ§Ãµes ao Gerar CobranÃ§a:

1. **Empresa obrigatÃ³ria**: Todas as consultas devem ter `empresa_fatura_id`
2. **Mesma empresa**: Consultas do mesmo paciente devem ter a mesma empresa
3. **CPF obrigatÃ³rio**: Paciente/responsÃ¡vel deve ter CPF cadastrado
4. **PermissÃ£o**: Apenas usuÃ¡rios Admin podem gerar cobranÃ§as

---

## ğŸ’¡ Casos Especiais

### Paciente com Consultas em Empresas Diferentes

```
CenÃ¡rio:
â€¢ JoÃ£o Silva tem 3 consultas na "Respira Kids"
â€¢ JoÃ£o Silva tem 2 consultas na "ClÃ­nica ABC"
```

**Como aparecem**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘¤ JoÃ£o Silva              3 consultas           â”‚
â”‚  ğŸ¢ Empresa: Respira Kids                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘¤ JoÃ£o Silva              2 consultas           â”‚
â”‚  ğŸ¢ Empresa: ClÃ­nica ABC                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**AÃ§Ã£o necessÃ¡ria**:

- âœ… Selecione cada grupo separadamente
- âœ… Gere cobranÃ§as em lotes diferentes
- âŒ NÃƒO tente selecionar consultas de empresas diferentes juntas

---

## ğŸ› Troubleshooting

### âŒ Erro: "Consultas sem empresa de faturamento configurada"

**Causa**: Consultas antigas ou criadas antes da validaÃ§Ã£o

**SoluÃ§Ã£o**:

1. Veja o console do navegador (F12 â†’ Console)
2. Identifique os IDs das consultas problemÃ¡ticas
3. Edite cada consulta (Agenda ou Pacientes)
4. Adicione a empresa de faturamento
5. Salve e tente novamente

**Ou use o SQL**:

- Execute `SQL_VERIFICAR_CONSULTAS_SEM_EMPRESA.sql`
- Identifique as consultas
- Use os scripts de correÃ§Ã£o se apropriado

### âš ï¸ Checkbox do Paciente Desabilitado

**Causa**: Paciente nÃ£o tem consultas elegÃ­veis para cobranÃ§a

**Motivos possÃ­veis**:

- Todas as consultas jÃ¡ foram pagas
- Todas tÃªm fatura gerada
- Todas estÃ£o canceladas
- Nenhuma tem empresa configurada

**SoluÃ§Ã£o**: Expanda o card e verifique o status individual de cada consulta

### ğŸ”„ SeleÃ§Ãµes "Somem" ao Mudar de PÃ¡gina

**Isso Ã© normal!** âœ…

- SeleÃ§Ãµes sÃ£o mantidas entre pÃ¡ginas
- O indicador mostra: "X consultas selecionadas"
- Volte Ã  pÃ¡gina anterior para ver as consultas selecionadas
- Use "Limpar tudo" para remover todas as seleÃ§Ãµes

---

## ğŸ“Š Resumo de Totais

Na parte inferior da lista, vocÃª sempre verÃ¡:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Total de consultas: 127                          â”‚
â”‚  Valor total: R$ 19.050,00                        â”‚
â”‚  NÃ£o pagas: 45                                    â”‚
â”‚  Pagas: 82                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Nota**: Estes valores refletem TODAS as consultas do filtro atual, nÃ£o apenas a pÃ¡gina visÃ­vel.

---

## ğŸ¯ Workflow Recomendado

### Para CobranÃ§a Mensal em Massa:

1. **Filtrar perÃ­odo**: "MÃªs anterior"
2. **Ativar modo**: "Agrupado" ğŸ‘¥
3. **Clicar em**: "Selecionar"
4. **Usar**: "Selecionar TODAS nÃ£o pagas"
5. **Revisar**: NÃºmero de consultas selecionadas
6. **Gerar**: CobranÃ§as em massa
7. **Verificar**: RelatÃ³rio de sucessos/falhas
8. **Corrigir**: Erros se necessÃ¡rio
9. **Repetir**: Passo 6 para consultas corrigidas

### Para CobranÃ§a de Paciente EspecÃ­fico:

1. **Buscar**: Nome do paciente
2. **Modo**: Agrupado ou Lista (tanto faz)
3. **Selecionar**: Checkbox do paciente (modo agrupado)
   - OU marcar consultas individuais (modo lista)
4. **Gerar**: CobranÃ§a
5. **Confirmar**: Sucesso

---

## ğŸ“Œ Atalhos e Dicas

- ğŸ” Use **Ctrl+F** no navegador para buscar na pÃ¡gina atual
- ğŸ“Š Ordene por "Paciente A-Z" para facilitar navegaÃ§Ã£o
- ğŸ”„ Use filtro de "Status: Pendente" + "Selecionar TODAS" para cobranÃ§a mensal
- ğŸ’¡ Expanda apenas os pacientes necessÃ¡rios para performance
- ğŸ¯ Use perÃ­odo curto primeiro para testar

---

## âœ… Checklist Antes de Gerar CobranÃ§as

- [ ] PerÃ­odo correto selecionado
- [ ] Filtros aplicados conforme necessÃ¡rio
- [ ] NÃºmero de seleÃ§Ãµes revisado
- [ ] Modo de agrupamento adequado ao caso
- [ ] Sem erros visÃ­veis de empresa de faturamento
- [ ] Pacientes com CPF cadastrado
- [ ] Token ASAAS configurado nas empresas

---

## ğŸ“ Suporte

Se o problema persistir:

1. Verifique o console do navegador (F12)
2. Execute os SQLs de verificaÃ§Ã£o
3. Documente o erro completo
4. Entre em contato com suporte tÃ©cnico

---

**Ãšltima atualizaÃ§Ã£o**: 08/10/2025
