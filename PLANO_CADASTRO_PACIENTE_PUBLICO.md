# üìã Plano de Implementa√ß√£o: Cadastro P√∫blico de Paciente

## üéØ Objetivo

Criar um fluxo intuitivo e mobile-first para cadastro p√∫blico de pacientes, onde o respons√°vel preenche todas as informa√ß√µes necess√°rias sem precisar de login.

---

## üìä An√°lise do Banco de Dados

### Tabelas Principais

1. **`pessoas`** - Tabela central para todos os tipos de pessoa
2. **`pessoa_tipos`** - Tipos: paciente, responsavel, pediatra, etc
3. **`pessoa_responsaveis`** - Relacionamento paciente ‚Üî respons√°vel
4. **`enderecos`** - Endere√ßos por CEP (UNIQUE constraint)
5. **`pessoa_pediatra`** - Dados espec√≠ficos de pediatras
6. **`paciente_pediatra`** - Relacionamento paciente ‚Üî pediatra
7. **`contract_templates`** / **`user_contracts`** - Contratos

### Campos Obrigat√≥rios em `pessoas`

- ‚úÖ `nome` (NOT NULL)
- ‚úÖ `id_tipo_pessoa` (NOT NULL)
- ‚úÖ `responsavel_cobranca_id` (NOT NULL) ‚ö†Ô∏è **CR√çTICO**
- ‚ùå `telefone` (nullable)
- ‚ùå `email` (nullable)
- ‚ùå `cpf_cnpj` (nullable)
- ‚ùå `id_endereco` (nullable)

### Tipos de Pessoa Dispon√≠veis

- `admin` - Administrador
- `profissional` - Fisioterapeuta
- `secretaria` - Secret√°ria
- **`paciente`** - Pessoa que recebe atendimento
- **`responsavel`** - Respons√°vel legal/financeiro
- `empresa` - Pessoa jur√≠dica
- `fornecedor` - Fornecedor

---

## üîç Fluxo Atual Implementado

### ‚úÖ Etapa 1: Valida√ß√£o de WhatsApp (CONCLU√çDA)

1. Usu√°rio digita n√∫mero de WhatsApp
2. Sistema valida via webhook externo
3. Sistema envia c√≥digo de 6 d√≠gitos
4. Usu√°rio valida c√≥digo (com expira√ß√£o e rate limiting)
5. Sistema busca na `vw_usuarios_admin` por telefone

**Resultado:**

- Se **existe**: Exibe boas-vindas e pacientes relacionados
- Se **n√£o existe**: Prossegue para cadastro

---

## üìù Fluxo Proposto para Cadastro Completo

### üé® Princ√≠pios de UX

- ‚ú® **Mobile-first** e responsivo
- üéØ **Uma pergunta por vez** (wizard step-by-step)
- üì± **Inputs otimizados** (teclado num√©rico, m√°scaras)
- ‚úÖ **Valida√ß√£o em tempo real** (com feedback visual)
- üíæ **Progresso salvo** (sessionStorage para recupera√ß√£o)
- üîô **Voltar permitido** (editar respostas anteriores)

---

## üó∫Ô∏è Sequ√™ncia de Cadastro (Order of Operations)

### **ETAPA 1: Valida√ß√£o WhatsApp** ‚úÖ IMPLEMENTADA

- [x] Validar n√∫mero
- [x] Enviar c√≥digo
- [x] Validar c√≥digo
- [x] Buscar usu√°rio existente

---

### **ETAPA 2: Identifica√ß√£o do Respons√°vel Legal**

**Pergunta:** "Voc√™ √© o respons√°vel legal pelo paciente?"

- **Op√ß√µes:**
  - ‚úÖ Sim, sou eu (auto-respons√°vel ou respons√°vel por outro)
  - ‚ùå N√£o, estou cadastrando para outra pessoa

**Se SIM:**

- Usar WhatsApp validado como respons√°vel
- Prosseguir para dados do respons√°vel

**Se N√ÉO:**

- Solicitar WhatsApp do respons√°vel legal
- Validar novo WhatsApp
- Prosseguir para dados do respons√°vel

---

### **ETAPA 3: Dados do Respons√°vel Legal**

**Campos:**

1. **Nome completo\*** (obrigat√≥rio)
   - Valida√ß√£o: m√≠nimo 3 caracteres
2. **CPF\*** (obrigat√≥rio)
   - Valida√ß√£o: CPF v√°lido
   - Valida√ß√£o: Verificar se j√° existe no sistema
   - M√°scara: 000.000.000-00
   - **Explica√ß√£o:** "O CPF √© obrigat√≥rio para emiss√£o de Nota Fiscal"

3. **Email\*** (obrigat√≥rio)
   - Valida√ß√£o: email v√°lido
   - **Explica√ß√£o:** "Avisos de agendamento, cobran√ßas e NF-e ser√£o enviados por email"
4. **Data de nascimento\***
   - Valida√ß√£o: maior de 18 anos (se auto-respons√°vel)
   - Formato: DD/MM/AAAA

---

### **ETAPA 4: Endere√ßo do Respons√°vel**

**Campos:**

1. **CEP\*** (obrigat√≥rio)
   - Buscar via API ViaCEP
   - Se encontrado: preencher logradouro, bairro, cidade, estado
   - Se n√£o encontrado: permitir preenchimento manual
   - Verificar se j√° existe em `enderecos` (UNIQUE constraint)

2. **N√∫mero\*** (obrigat√≥rio)
   - Valida√ß√£o: num√©rico ou "S/N"
3. **Complemento** (opcional)
   - Ex: Apto 101, Bloco A

**Fluxo:**

```
1. Digitar CEP
2. Buscar ViaCEP
3. Se existe no banco: reutilizar
4. Se n√£o existe: inserir em `enderecos`
5. Salvar `id_endereco` + `numero_endereco` + `complemento_endereco` em `pessoas`
```

---

### **ETAPA 5: Respons√°vel Financeiro**

**Pergunta:** "Quem ser√° respons√°vel pela parte financeira?"

- **Op√ß√µes:**
  - ‚úÖ Eu mesmo (respons√°vel legal = financeiro)
  - ‚ùå Outra pessoa

**Se OUTRA PESSOA:**

- Repetir fluxo de cadastro (Nome, CPF, Email, WhatsApp, Endere√ßo)
- Validar WhatsApp (diferente do respons√°vel legal)
- **Valida√ß√£o:** WhatsApp n√£o pode ser o mesmo do respons√°vel legal

**Resultado:**

- `responsavel_legal_id`: UUID do respons√°vel legal
- `responsavel_financeiro_id`: UUID do respons√°vel financeiro (ou mesmo que legal)

---

### **ETAPA 6: Dados do Paciente**

**Campos:**

1. **Nome completo\*** (obrigat√≥rio)
   - Valida√ß√£o: m√≠nimo 3 caracteres

2. **Data de nascimento\*** (obrigat√≥rio)
   - Valida√ß√£o: n√£o pode ser futura
   - Valida√ß√£o: calcular idade automaticamente
3. **Sexo\*** (obrigat√≥rio)
   - Op√ß√µes: Masculino (M) / Feminino (F)
4. **CPF** (condicional)
   - **Pergunta adicional:** "A Nota Fiscal ser√° emitida no nome de quem?"
   - Op√ß√µes:
     - Respons√°vel Financeiro (usar CPF j√° cadastrado)
     - Paciente (solicitar CPF do paciente)
   - Se paciente: validar CPF

---

### **ETAPA 7: Pediatra do Paciente** ‚ö†Ô∏è ATEN√á√ÉO ESPECIAL

**Problema:** Duplica√ß√£o de pediatras (Dr. Zaconeta, Carlos Zaconeta, Carlos Alberto Zaconeta)

**Solu√ß√£o:** Autocomplete inteligente

**Campos:**

1. **Nome do Pediatra\*** (obrigat√≥rio)
   - Input com autocomplete
   - Buscar em `vw_usuarios_admin` filtrando por `is_pediatra = true`
   - Remover prefixos "Dr.", "Dra." antes de buscar
   - Buscar por similaridade (ILIKE)
2. **CRM** (opcional, mas recomendado)
   - Se novo pediatra: solicitar CRM
   - Se existente: exibir CRM cadastrado

**Fluxo:**

```typescript
// Usu√°rio digita: "Dr. Carlos"
1. Remover "Dr.", "Dra."
2. Buscar: nome ILIKE '%Carlos%'
3. Exibir resultados:
   - Carlos Alberto Zaconeta (CRM: 12345)
   - Carlos Silva (CRM: 67890)

// Se usu√°rio selecionar existente:
4. Usar pessoa_pediatra.id existente

// Se usu√°rio continuar digitando (n√£o selecionar):
5. Ao finalizar: "N√£o encontramos esse pediatra. Deseja cadastrar?"
6. Solicitar CRM (opcional)
7. Criar novo pediatra:
   - INSERT em `pessoas` (tipo: pediatra)
   - INSERT em `pessoa_pediatra`
```

**RLS:** ‚ö†Ô∏è Liberar leitura p√∫blica em `vw_usuarios_admin` WHERE `is_pediatra = true`

**Componente:**

- `<PediatricianAutocomplete />` - Primitivo reutiliz√°vel

---

### **ETAPA 8: Autoriza√ß√µes e Consentimentos**

**Campos (todos obrigat√≥rios para prosseguir):**

1. ‚òëÔ∏è **Autoriza√ß√£o uso cient√≠fico**
   - "Autorizo o uso de informa√ß√µes para fins cient√≠ficos (anonimizado)"
2. ‚òëÔ∏è **Autoriza√ß√£o uso redes sociais**
   - "Autorizo o uso de imagens/v√≠deos em redes sociais"
3. ‚òëÔ∏è **Autoriza√ß√£o uso do nome**
   - "Autorizo o uso do nome em publica√ß√µes"

**Salvar em:**

- `pessoas.autorizacao_uso_cientifico`
- `pessoas.autorizacao_uso_redes_sociais`
- `pessoas.autorizacao_uso_do_nome`

---

### **ETAPA 9: Revis√£o e Confirma√ß√£o**

**Exibir resumo:**

- ‚úÖ Respons√°vel Legal: Nome, CPF, WhatsApp
- ‚úÖ Respons√°vel Financeiro: Nome, CPF (se diferente)
- ‚úÖ Endere√ßo completo
- ‚úÖ Paciente: Nome, Data Nascimento, Sexo
- ‚úÖ Pediatra: Nome, CRM
- ‚úÖ Autoriza√ß√µes: Sim/N√£o para cada
- ‚úÖ NF-e: Emitida em nome de {Respons√°vel/Paciente}

**A√ß√µes:**

- ‚úèÔ∏è Editar qualquer etapa
- ‚úÖ Confirmar e enviar

---

### **ETAPA 10: Contrato (POSTERIOR)** üöß

**Implementar depois:**

- Gerar contrato baseado em `contract_templates`
- Substituir vari√°veis din√¢micas
- Gerar PDF
- Solicitar assinatura digital (futura integra√ß√£o)
- Salvar em `user_contracts`

**Vari√°veis do contrato:**

```json
{
  "{{paciente_nome}}": "Jo√£o Silva",
  "{{paciente_data_nascimento}}": "01/01/2020",
  "{{responsavel_nome}}": "Maria Silva",
  "{{responsavel_cpf}}": "000.000.000-00",
  "{{data_assinatura}}": "01/12/2024",
  "{{endereco_completo}}": "Rua X, 123 - Bairro Y, Cidade/UF"
}
```

---

## üîÑ Ordem de Inser√ß√£o no Banco de Dados

### Sequ√™ncia para evitar erros de Foreign Key:

```sql
-- 1. Buscar ou criar ENDERE√áO
SELECT id FROM enderecos WHERE cep = '70000-000';
-- Se n√£o existir:
INSERT INTO enderecos (cep, logradouro, bairro, cidade, estado) VALUES (...);

-- 2. Buscar TIPOS DE PESSOA
SELECT id FROM pessoa_tipos WHERE codigo = 'responsavel'; -- responsavel_tipo_id
SELECT id FROM pessoa_tipos WHERE codigo = 'paciente'; -- paciente_tipo_id
SELECT id FROM pessoa_tipos WHERE codigo = 'pediatra'; -- pediatra_tipo_id (se novo)

-- 3. Criar RESPONS√ÅVEL LEGAL
INSERT INTO pessoas (
  nome, cpf_cnpj, telefone, email, data_nascimento,
  id_tipo_pessoa, id_endereco, numero_endereco, complemento_endereco,
  responsavel_cobranca_id, -- ‚ö†Ô∏è AUTO-REFER√äNCIA TEMPOR√ÅRIA (NULL ou pr√≥prio ID)
  ativo
) VALUES (...) RETURNING id; -- responsavel_legal_id

-- 3.1. Atualizar AUTO-REFER√äNCIA
UPDATE pessoas
SET responsavel_cobranca_id = id
WHERE id = responsavel_legal_id
AND responsavel_cobranca_id IS NULL;

-- 4. Criar RESPONS√ÅVEL FINANCEIRO (se diferente)
-- Se for o mesmo: responsavel_financeiro_id = responsavel_legal_id
-- Se for diferente: repetir INSERT similar ao passo 3

-- 5. Criar/Buscar PEDIATRA
-- Se existente: usar pessoa_pediatra.id
-- Se novo:
INSERT INTO pessoas (
  nome, id_tipo_pessoa, responsavel_cobranca_id, ativo
) VALUES (...) RETURNING id; -- pediatra_pessoa_id

INSERT INTO pessoa_pediatra (
  pessoa_id, crm, especialidade, ativo
) VALUES (pediatra_pessoa_id, 'CRM123', 'Pediatria', true)
RETURNING id; -- pediatra_id

-- 6. Criar PACIENTE
INSERT INTO pessoas (
  nome, data_nascimento, sexo, cpf_cnpj,
  id_tipo_pessoa,
  responsavel_cobranca_id, -- ‚ö†Ô∏è OBRIGAT√ìRIO: responsavel_financeiro_id
  autorizacao_uso_cientifico,
  autorizacao_uso_redes_sociais,
  autorizacao_uso_do_nome,
  ativo
) VALUES (...) RETURNING id; -- paciente_id

-- 7. Criar RELACIONAMENTO paciente ‚Üî respons√°vel legal
INSERT INTO pessoa_responsaveis (
  id_pessoa, id_responsavel, tipo_responsabilidade, ativo
) VALUES (paciente_id, responsavel_legal_id, 'legal', true);

-- 8. Criar RELACIONAMENTO paciente ‚Üî respons√°vel financeiro (se diferente)
IF responsavel_financeiro_id != responsavel_legal_id THEN
  INSERT INTO pessoa_responsaveis (
    id_pessoa, id_responsavel, tipo_responsabilidade, ativo
  ) VALUES (paciente_id, responsavel_financeiro_id, 'financeiro', true);
END IF;

-- 9. Criar RELACIONAMENTO paciente ‚Üî pediatra
INSERT INTO paciente_pediatra (
  paciente_id, pediatra_id, ativo
) VALUES (paciente_id, pediatra_id, true);
```

---

## üèóÔ∏è Arquitetura de Componentes

### Estrutura de Pastas

```
src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ primitives/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PhoneInput.tsx ‚úÖ (j√° existe)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CPFInput.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DateInput.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CEPInput.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PediatricianAutocomplete.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProgressBar.tsx
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ composed/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ WhatsAppValidationStep.tsx ‚úÖ (j√° existe)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ResponsibleIdentificationStep.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ResponsibleDataStep.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AddressStep.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FinancialResponsibleStep.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PatientDataStep.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PediatricianStep.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthorizationsStep.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ReviewStep.tsx
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ patient/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ PatientRegistrationSteps.tsx ‚úÖ (j√° existe - expandir)
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ PatientRegistrationProgress.tsx
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ templates/
‚îÇ       ‚îî‚îÄ‚îÄ PublicPageLayout.tsx ‚úÖ (j√° existe)
‚îÇ
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ patient-registration-api.ts ‚úÖ (expandir)
‚îÇ   ‚îú‚îÄ‚îÄ viacep-api.ts
‚îÇ   ‚îî‚îÄ‚îÄ pediatrician-api.ts
‚îÇ
‚îî‚îÄ‚îÄ pages/
    ‚îî‚îÄ‚îÄ PatientPublicRegistrationPage.tsx ‚úÖ (j√° existe)
```

### Estado Global (PatientRegistrationSteps)

```typescript
interface PatientRegistrationData {
  // Etapa 1: WhatsApp (‚úÖ implementado)
  whatsappJid: string;
  whatsappValidated: boolean;

  // Etapa 2: Identifica√ß√£o
  isSelfResponsible: boolean;

  // Etapa 3: Respons√°vel Legal
  responsavelLegal: {
    nome: string;
    cpf: string;
    email: string;
    dataNascimento: string;
    telefone: string; // Se diferente do WhatsApp validado
  };

  // Etapa 4: Endere√ßo
  endereco: {
    cep: string;
    logradouro: string;
    bairro: string;
    cidade: string;
    estado: string;
    numero: string;
    complemento?: string;
    enderecoId?: string; // Se j√° existe no banco
  };

  // Etapa 5: Respons√°vel Financeiro
  responsavelFinanceiro: {
    mesmoQueLegal: boolean;
    nome?: string;
    cpf?: string;
    email?: string;
    telefone?: string;
    whatsappJid?: string;
    endereco?: typeof endereco;
  };

  // Etapa 6: Paciente
  paciente: {
    nome: string;
    dataNascimento: string;
    sexo: 'M' | 'F';
    cpf?: string; // Se NF-e em nome do paciente
    nfeEmNomeDe: 'responsavel' | 'paciente';
  };

  // Etapa 7: Pediatra
  pediatra: {
    id?: string; // Se existente
    nome: string;
    crm?: string;
    isNew: boolean;
  };

  // Etapa 8: Autoriza√ß√µes
  autorizacoes: {
    usoCientifico: boolean;
    usoRedesSociais: boolean;
    usoNome: boolean;
  };
}
```

---

## üîê RLS (Row Level Security)

### Pol√≠ticas Necess√°rias:

```sql
-- Permitir leitura p√∫blica de pediatras (autocomplete)
CREATE POLICY "Public read pediatricians"
ON vw_usuarios_admin
FOR SELECT
USING (is_pediatra = true);

-- Permitir leitura p√∫blica de endere√ßos (busca por CEP)
CREATE POLICY "Public read addresses"
ON enderecos
FOR SELECT
USING (true);

-- Permitir inser√ß√£o p√∫blica em pessoas (via Edge Function)
-- (Service Role na Edge Function j√° tem permiss√£o)
```

---

## üì± API/Edge Functions

### Edge Function: `public-patient-registration`

**Responsabilidades:**

1. Validar todos os dados recebidos
2. Verificar duplica√ß√µes (CPF, telefone)
3. Buscar ou criar endere√ßo
4. Criar respons√°veis
5. Criar paciente
6. Criar relacionamentos
7. Retornar ID do paciente criado

**Request:**

```typescript
{
  action: 'register_patient',
  data: PatientRegistrationData
}
```

**Response:**

```typescript
{
  success: boolean,
  pacienteId?: string,
  error?: string
}
```

---

## üß™ Plano de Testes

### Cen√°rios de Teste:

1. **Respons√°vel legal = financeiro (auto-respons√°vel)**
   - Adulto cadastrando a si mesmo
2. **Respons√°vel legal ‚â† financeiro**
   - M√£e (legal) e pai (financeiro)
3. **Paciente menor de 18 anos**
   - NF-e em nome do respons√°vel
4. **Paciente maior de 18 anos**
   - NF-e pode ser em nome do paciente
5. **Pediatra existente**
   - Selecionar do autocomplete
6. **Pediatra novo**
   - Cadastrar com CRM
7. **CEP existente no banco**
   - Reutilizar endere√ßo
8. **CEP n√£o existe**
   - Criar novo endere√ßo
9. **CPF duplicado**
   - Exibir erro "CPF j√° cadastrado"
10. **WhatsApp duplicado**
    - Exibir "Voc√™ j√° possui cadastro"

---

## üìÖ Cronograma de Implementa√ß√£o

### Sprint 1 (3-4 dias)

- [x] Etapa 1: Valida√ß√£o WhatsApp ‚úÖ CONCLU√çDA
- [ ] Etapa 2: Identifica√ß√£o do Respons√°vel
- [ ] Etapa 3: Dados do Respons√°vel Legal
- [ ] Componentes primitivos (CPFInput, DateInput)

### Sprint 2 (3-4 dias)

- [ ] Etapa 4: Endere√ßo (com ViaCEP)
- [ ] Etapa 5: Respons√°vel Financeiro
- [ ] API ViaCEP integration
- [ ] CEPInput component

### Sprint 3 (3-4 dias)

- [ ] Etapa 6: Dados do Paciente
- [ ] Etapa 7: Pediatra (Autocomplete)
- [ ] PediatricianAutocomplete component
- [ ] RLS policies para pediatras

### Sprint 4 (2-3 dias)

- [ ] Etapa 8: Autoriza√ß√µes
- [ ] Etapa 9: Revis√£o
- [ ] Edge Function: public-patient-registration
- [ ] Integra√ß√£o completa end-to-end

### Sprint 5 (2-3 dias)

- [ ] Testes completos
- [ ] Ajustes de UX
- [ ] Performance optimization
- [ ] Deploy e monitoramento

### (Futuro) Sprint 6

- [ ] Etapa 10: Contrato
- [ ] Template engine para contratos
- [ ] Gera√ß√£o de PDF
- [ ] Assinatura digital

---

## üé® Wireframes (High-Level)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  [Logo Respira Kids]                ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ     ‚îÇ <- Progress bar
‚îÇ  Etapa 3 de 9                       ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  Dados do Respons√°vel Legal         ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ    ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  Nome completo *                    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ Maria Silva                 ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  CPF *                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ 000.000.000-00              ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ  üí° Necess√°rio para emiss√£o de NF   ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  Email *                            ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ maria@email.com             ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ  üí° Avisos ser√£o enviados por email ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  [‚Üê Voltar]  [Continuar ‚Üí]        ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  üîí Seus dados s√£o protegidos       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üö® Pontos de Aten√ß√£o

### ‚ö†Ô∏è CR√çTICOS

1. **`responsavel_cobranca_id` √© obrigat√≥rio** - Sempre definir antes de criar paciente
2. **Evitar duplica√ß√£o de pediatras** - Implementar autocomplete robusto
3. **Validar CPF duplicado** - Antes de inserir
4. **CEP √∫nico** - Constraint no banco, tratar erro se j√° existe
5. **WhatsApp √∫nico por respons√°vel** - N√£o pode haver 2 respons√°veis com mesmo WhatsApp

### üìù Melhorias Futuras

- [ ] Valida√ß√£o de CPF na Receita Federal (API)
- [ ] Integra√ß√£o com Asaas para criar customer automaticamente
- [ ] Notifica√ß√£o por email ap√≥s cadastro
- [ ] Dashboard para o respons√°vel ver agendamentos (futuro)
- [ ] App mobile nativo

---

## üìö Documentos Relacionados

- ‚úÖ `VALIDACAO_WHATSAPP_BACKEND.md` - Sistema de valida√ß√£o atual
- ‚úÖ `CADASTRO_PACIENTE_PUBLICO.md` - Documenta√ß√£o inicial
- üìù `CONTRACT_TEMPLATE_GUIDE.md` - A criar (para contratos)

---

**Desenvolvido com ‚ù§Ô∏è para Respira Kids**
